function JOURNEY(t,e,r,i){this.routeType=t,this.stopId=e,this.routeId=r,this.directionId=i}function generatehash(t,e){return CryptoJS.HmacSHA1(t,e).toString()}function constructDepartureURL(t,e,r,i){var n="/v3/departures/route_type/"+t+"/stop/"+e+"/route/"+r+"?direction_id="+i+"&"+params;return ptvbaseurl+n+"&signature="+generatehash(n,key)}function constructArrivalURL(t,e,r){var i="/v3/pattern/run/"+t+"/route_type/"+e+"?stop_id="+r+"&"+params;return ptvbaseurl+i+"&signature="+generatehash(i,key)}function filterfortimewindow(t,e,r,i){var n=t.departures.filter(function(t){var n=moment(t.scheduled_departure_utc).unix();return n>e-r&&n<e+i});return void 0===n?"No Buses":n}function filterforstop(t,e){return t.departures.filter(function(t){return t.stop_id==e})}function showtraindepartures(){window.location="./index.html"}function timeconversion(t,e){var r;if(0===e)return r="<ul class='list-group'>",$.each(t,function(t,e){r+="<li class='list-group-item'><a class='"+e.stop_id+"' id='"+e.run_id+"' onclick='showbuses(this)'>"+new Date(e.scheduled_departure_utc).toLocaleTimeString()+"</a></li>"}),r+="</ul>";if(1==e)return r="<p class='list-group-item'>"+new Date(t[0].scheduled_departure_utc).toLocaleTimeString()+"</p>";if(2==e)return r="<p class='list-group-item'>"+new Date(t[0].scheduled_departure_utc).toLocaleTimeString()+"</p>",r+="<button type='button' onclick='showtraindepartures()' class='btn btn-primary'>Back to train station</button>";throw"You broke it"}function showbuses(t){$("#trainList, #trainList2").hide();var e,r=constructArrivalURL(t.id,0,1023);$.getJSON(r,function(t){e=filterforstop(t,1023),$("#busList").html("<h2>Train/Bus Connections</h2>"),$("#busList").append("<h3 class='text-primary'>Train arrives</h3>"+timeconversion(e,1))}).done(function(){var t=constructDepartureURL(2,10885,952,28);$.getJSON(t,function(t){var r=filterfortimewindow(t,moment(e[0].scheduled_departure_utc).unix(),0,3600);$("#busList").append("<h3 class='text-primary'>Bus departs</h3>"+timeconversion(r,2))})})}function showtrainbusconnection(t,e){$.getJSON(t,function(t){var e=filterfortimewindow(t,moment().unix(),900,900);$("#trainList").html("<h2 class='text-primary'>Belgrave</h2>"+timeconversion(e,0))}),$.getJSON(e,function(t){var e=filterfortimewindow(t,moment().unix(),900,900);$("#trainList2").html("<h2 class='text-primary'>Lilydale</h2>"+timeconversion(e,0))})}var routeTypes={train:0,bus:2},routeIds={belgrave:2,lilydale:9,736:952},directionIds={belgrave:3,lilydale:9,mitcham:28},stopIds={blackburn:1023,boxhill:1026,flindersst:1071,melbournecentral:1120,southerncross:1181,parliament:1155,richmond:1162,blackburn736:10885};$(function(){$("button.btntrain").click(function(){$("#trainbuttons").hide();var t=new JOURNEY(routeTypes[this.getAttribute("data-routeType")],stopIds[this.getAttribute("data-stopId")],routeIds.belgrave,directionIds.belgrave),e=new JOURNEY(routeTypes[this.getAttribute("data-routeType")],stopIds[this.getAttribute("data-stopId")],routeIds.lilydale,directionIds.lilydale);showtrainbusconnection(constructDepartureURL(t.routeType,t.stopId,t.routeId,t.directionId),constructDepartureURL(e.routeType,e.stopId,e.routeId,e.directionId))})});var key="e3b65a3c-5366-4b26-807f-8b89f6653b0f",ptvbaseurl="https://timetableapi.ptv.vic.gov.au",params=$.param({devid:3000187});moment.locale("en-au");